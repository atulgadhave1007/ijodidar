<!-- Ensure Bootstrap JS is loaded in your base.html -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<div class="container my-5">

  <!-- Image Carousel -->
  {% if current_user.profile_images %}
  <div id="profileImageCarousel" class="carousel slide mb-4" data-bs-ride="carousel" style="max-width: 600px; margin: auto;">
    
    <div class="carousel-inner">
      {% for image in current_user.profile_images %}
      <div class="carousel-item {% if loop.first %}active{% endif %}">
        <div class="position-relative text-center">
          <img src="{{ image.image_url }}"
               class="d-block w-100 rounded"
               style="max-height: 400px; object-fit: cover;"
               alt="User image">

          <!-- Delete Button -->
          <form method="POST" action="{{ url_for('delete_image', image_id=image.id) }}"
                style="position: absolute; top: 10px; right: 10px; z-index: 10;">
            <button class="btn btn-sm btn-danger" onclick="return confirm('Delete this image?')">âœ–</button>
          </form>

          <!-- Set as Primary / Primary Badge -->
          {% if image.is_primary %}
            <span class="badge bg-primary position-absolute top-0 start-0 m-2">Primary</span>
          {% else %}
            <a href="{{ url_for('set_primary_image', image_id=image.id) }}"
               class="btn btn-sm btn-outline-primary position-absolute top-0 start-0 m-2">Set as Primary</a>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Carousel Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#profileImageCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#profileImageCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>
  {% else %}
    <div class="text-center mb-4">
      <img src="https://via.placeholder.com/500x300?text=No+Images" class="img-fluid rounded" alt="No image">
      <p class="text-muted mt-2">No images uploaded yet.</p>
    </div>
  {% endif %}

  <!-- Upload Form -->
  <form action="{{ url_for('upload_image') }}" method="POST" enctype="multipart/form-data" style="max-width: 600px; margin: auto;">
    <div class="mb-3">
      <label for="image" class="form-label">Upload New Image</label>
      <input type="file" class="form-control" name="image" accept="image/*" required>
    </div>
    <div class="form-check mb-3">
      <input class="form-check-input" type="checkbox" name="is_primary" id="isPrimary">
      <label class="form-check-label" for="isPrimary">Set as primary image</label>
    </div>
    <button type="submit" class="btn btn-success w-100">Upload Image</button>
  </form>

</div>
